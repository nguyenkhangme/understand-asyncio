<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1021px" preserveAspectRatio="none" style="width:911px;height:1021px;background:#FFFFFF;" version="1.1" viewBox="0 0 911 1021" width="911px" zoomAndPan="magnify"><title>asyncio Task interleave &amp; overlapping</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="275.6113" x="324.7292" y="28.5352">asyncio Task interleave &amp; overlapping</text><g><title>Event Loop</title><rect fill="#FFFFFF" height="823.248" style="stroke:#181818;stroke-width:1;" width="10" x="64.2319" y="100.4648"/></g><g><title>Task-1.__step..</title><rect fill="#FFFFFF" height="458.5898" style="stroke:#181818;stroke-width:1;" width="10" x="367.1313" y="121.7754"/></g><g><title>Task-2.__step..</title><rect fill="#FFFFFF" height="278.7266" style="stroke:#181818;stroke-width:1;" width="10" x="667.0093" y="609.6758"/></g><g><title>Event Loop</title><rect fill="#000000" fill-opacity="0.00000" height="924.1797" width="8" x="65.2319" y="90.4648"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="69" x2="69" y1="90.4648" y2="1014.6445"/></g><g><title>Task-1.__step..</title><rect fill="#000000" fill-opacity="0.00000" height="924.1797" width="8" x="368.1313" y="90.4648"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="371.4434" x2="371.4434" y1="90.4648" y2="1014.6445"/></g><g><title>Task-2.__step..</title><rect fill="#000000" fill-opacity="0.00000" height="924.1797" width="8" x="668.0093" y="90.4648"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="671.3213" x2="671.3213" y1="90.4648" y2="1014.6445"/></g><g class="participant participant-head" data-participant="L"><rect fill="#64BEF6" fill-opacity="0.52941" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="88.4639" x="25" y="58.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.4639" x="32" y="79.5117">Event Loop</text></g><g class="participant participant-head" data-participant="T1"><rect fill="#64BEF6" fill-opacity="0.52941" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119.376" x="312.4434" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.376" x="319.4434" y="63.0234">Task-1.__step()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.6846" x="328.2891" y="79.5117">async_main()</text></g><g class="participant participant-head" data-participant="T2"><rect fill="#64BEF6" fill-opacity="0.52941" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119.376" x="612.3213" y="42.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.376" x="619.3213" y="63.0234">Task-2.__step()</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33.7422" x="655.1382" y="79.5117">tick()</text></g><g><title>Event Loop</title><rect fill="#FFFFFF" height="823.248" style="stroke:#181818;stroke-width:1;" width="10" x="64.2319" y="100.4648"/></g><g><title>Task-1.__step..</title><rect fill="#FFFFFF" height="458.5898" style="stroke:#181818;stroke-width:1;" width="10" x="367.1313" y="121.7754"/></g><g><title>Task-2.__step..</title><rect fill="#FFFFFF" height="278.7266" style="stroke:#181818;stroke-width:1;" width="10" x="667.0093" y="609.6758"/></g><g class="message" data-participant-1="L" data-participant-2="T1"><polygon fill="#181818" points="355.1313,117.7754,365.1313,121.7754,355.1313,125.7754,359.1313,121.7754" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="74.2319" x2="361.1313" y1="121.7754" y2="121.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.3896" x="173.4868" y="117.0332">call T1.__step()</text></g><g class="message" data-participant-1="T1" data-participant-2="T1"><line style="stroke:#181818;stroke-width:1;" x1="377.1313" x2="419.1313" y1="151.0859" y2="151.0859"/><line style="stroke:#181818;stroke-width:1;" x1="419.1313" x2="419.1313" y1="151.0859" y2="164.0859"/><line style="stroke:#181818;stroke-width:1;" x1="378.1313" x2="419.1313" y1="164.0859" y2="164.0859"/><polygon fill="#181818" points="388.1313,160.0859,378.1313,164.0859,388.1313,168.0859,384.1313,164.0859" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.2485" x="384.1313" y="146.3438">asyncio.create_task(tick()) (T2)</text></g><g class="message" data-participant-1="T1" data-participant-2="L"><polygon fill="#181818" points="85.2319,189.3965,75.2319,193.3965,85.2319,197.3965,81.2319,193.3965" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="79.2319" x2="366.1313" y1="193.3965" y2="193.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.8828" x="156.2402" y="188.6543">schedule T2.__step()</text></g><path d="M79,206.3965 L79,261.3965 L329,261.3965 L329,216.3965 L319,206.3965 L79,206.3965" fill="#3BC2EF" fill-opacity="0.20000" style="stroke:#181818;stroke-width:0.5;"/><path d="M319,206.3965 L319,216.3965 L329,216.3965 L319,206.3965" fill="#3BC2EF" fill-opacity="0.20000" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.4131" x="85" y="223.9648">When created,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229.9629" x="85" y="239.2754">the task auto-schedules to call soon</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67.7295" x="85" y="254.5859">its __step()</text><path d="M79,272.3281 L79,327.3281 L352,327.3281 L352,282.3281 L342,272.3281 L79,272.3281" fill="#3BC2EF" fill-opacity="0.20000" style="stroke:#181818;stroke-width:0.5;"/><path d="M342,272.3281 L342,282.3281 L352,282.3281 L342,272.3281" fill="#3BC2EF" fill-opacity="0.20000" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219.6543" x="85" y="289.8965">loop's ready = deque([T2.__step()])</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248.2886" x="85" y="305.207">(we will use Tx only after this for short)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.5034" x="85" y="320.5176">scheduled = [] (this is a heap)</text><g class="message" data-participant-1="T1" data-participant-2="T1"><line style="stroke:#181818;stroke-width:1;" x1="377.1313" x2="419.1313" y1="369.8809" y2="369.8809"/><line style="stroke:#181818;stroke-width:1;" x1="419.1313" x2="419.1313" y1="369.8809" y2="382.8809"/><line style="stroke:#181818;stroke-width:1;" x1="378.1313" x2="419.1313" y1="382.8809" y2="382.8809"/><polygon fill="#181818" points="388.1313,378.8809,378.1313,382.8809,388.1313,386.8809,384.1313,382.8809" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265.8779" x="384.1313" y="349.8281">since it never hit something that suspend,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.457" x="438.8418" y="365.1387">T1 just continue running</text></g><g class="message" data-participant-1="T1" data-participant-2="T1"><line style="stroke:#181818;stroke-width:1;" x1="377.1313" x2="419.1313" y1="442.8125" y2="442.8125"/><line style="stroke:#181818;stroke-width:1;" x1="419.1313" x2="419.1313" y1="442.8125" y2="455.8125"/><line style="stroke:#181818;stroke-width:1;" x1="378.1313" x2="419.1313" y1="455.8125" y2="455.8125"/><polygon fill="#181818" points="388.1313,451.8125,378.1313,455.8125,388.1313,459.8125,384.1313,455.8125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.9292" x="408.4429" y="407.4492">Finish running,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.4058" x="396.2046" y="422.7598">raise StopIteration,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.5522" x="384.1313" y="438.0703">mark this task as done</text></g><g class="message" data-participant-1="T1" data-participant-2="L"><polygon fill="#181818" points="85.2319,481.123,75.2319,485.123,85.2319,489.123,81.2319,485.123" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="79.2319" x2="366.1313" y1="485.123" y2="485.123"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227.2651" x="107.0491" y="480.3809">schedule a callback to stop the loop</text></g><path d="M79,498.123 L79,538.123 L353,538.123 L353,508.123 L343,498.123 L79,498.123" fill="#3BC2EF" fill-opacity="0.20000" style="stroke:#181818;stroke-width:0.5;"/><path d="M343,498.123 L343,508.123 L353,508.123 L343,498.123" fill="#3BC2EF" fill-opacity="0.20000" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253.3096" x="85" y="515.6914">ready = deque([T2, stop_loop_callback])</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.0444" x="85" y="531.002">scheduled = []</text><g class="message" data-participant-1="T1" data-participant-2="L"><polygon fill="#181818" points="85.2319,576.3652,75.2319,580.3652,85.2319,584.3652,81.2319,580.3652" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="79.2319" x2="371.1313" y1="580.3652" y2="580.3652"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.5288" x="174.9172" y="560.3125">T1.__step() end</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.8604" x="166.8081" y="575.623">back to event loop</text></g><g class="message" data-participant-1="L" data-participant-2="T2"><polygon fill="#181818" points="655.0093,605.6758,665.0093,609.6758,655.0093,613.6758,659.0093,609.6758" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="74.2319" x2="661.0093" y1="609.6758" y2="609.6758"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.3896" x="323.4258" y="604.9336">call T2.__step()</text></g><path d="M79,622.6758 L79,662.6758 L328,662.6758 L328,632.6758 L318,622.6758 L79,622.6758" fill="#3BC2EF" fill-opacity="0.20000" style="stroke:#181818;stroke-width:0.5;"/><path d="M318,622.6758 L318,632.6758 L328,632.6758 L318,622.6758" fill="#3BC2EF" fill-opacity="0.20000" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228.6426" x="85" y="640.2441">ready = deque([stop_loop_callback])</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.0444" x="85" y="655.5547">scheduled = []</text><g class="message" data-participant-1="T2" data-participant-2="T2"><line style="stroke:#181818;stroke-width:1;" x1="677.0093" x2="719.0093" y1="720.2285" y2="720.2285"/><line style="stroke:#181818;stroke-width:1;" x1="719.0093" x2="719.0093" y1="720.2285" y2="733.2285"/><line style="stroke:#181818;stroke-width:1;" x1="678.0093" x2="719.0093" y1="733.2285" y2="733.2285"/><polygon fill="#181818" points="688.0093,729.2285,678.0093,733.2285,688.0093,737.2285,684.0093,733.2285" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.0171" x="725.031" y="684.8652">await asyncio.sleep(2)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.2676" x="737.4058" y="700.1758">(which is a future)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215.9473" x="688.1226" y="715.4863">add_done_callback() to that future</text></g><g class="message" data-participant-1="T2" data-participant-2="L"><polygon fill="#181818" points="85.2319,789.1602,75.2319,793.1602,85.2319,797.1602,81.2319,793.1602" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="79.2319" x2="666.0093" y1="793.1602" y2="793.1602"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217.1089" x="262.0662" y="757.7969">schedule to call a callback after 2s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.8218" x="283.1531" y="773.1074">to mark that future is done</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229.8169" x="257.7688" y="788.418">(implemented inside asyncio.sleep())</text></g><path d="M79,806.1602 L79,846.1602 L328,846.1602 L328,816.1602 L318,806.1602 L79,806.1602" fill="#3BC2EF" fill-opacity="0.20000" style="stroke:#181818;stroke-width:0.5;"/><path d="M318,806.1602 L318,816.1602 L328,816.1602 L318,806.1602" fill="#3BC2EF" fill-opacity="0.20000" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228.6426" x="85" y="823.7285">ready = deque([stop_loop_callback])</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219.229" x="85" y="839.0391">scheduled = [sleep_2_callback_T2]</text><g class="message" data-participant-1="T2" data-participant-2="L"><polygon fill="#181818" points="85.2319,884.4023,75.2319,888.4023,85.2319,892.4023,81.2319,888.4023" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="79.2319" x2="671.0093" y1="888.4023" y2="888.4023"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="255.7153" x="245.2629" y="868.3496">T2.__step() end (hit await that suspends)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.8604" x="316.7471" y="883.6602">back to event loop</text></g><g class="message" data-participant-1="L" data-participant-2="L"><line style="stroke:#181818;stroke-width:1;" x1="74.2319" x2="116.2319" y1="922.7129" y2="922.7129"/><line style="stroke:#181818;stroke-width:1;" x1="116.2319" x2="116.2319" y1="922.7129" y2="935.7129"/><line style="stroke:#181818;stroke-width:1;" x1="69.2319" x2="116.2319" y1="935.7129" y2="935.7129"/><polygon fill="#181818" points="79.2319,931.7129,69.2319,935.7129,79.2319,939.7129,75.2319,935.7129" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268.8994" x="81.2319" y="917.9707">run stop_loop_callback that stops the loop</text></g><path d="M74,943.7129 L74,998.7129 L363,998.7129 L363,953.7129 L353,943.7129 L74,943.7129" fill="#3BC2EF" fill-opacity="0.20000" style="stroke:#181818;stroke-width:0.5;"/><path d="M353,943.7129 L353,953.7129 L363,953.7129 L353,943.7129" fill="#3BC2EF" fill-opacity="0.20000" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268.6265" x="80" y="961.2813">sleep_2_callback_T2 has never been called</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227.1509" x="80" y="976.5918">because the loop is already stopped</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.4302" x="80" y="991.9023">and the program exited</text><!--SRC=[hLLTQzmm47pNhrXQQ6r8GgEKj1HQw4CBXIi4Uj2791YTlNTIpoUvbdoN_FkE_7Ls6a8AXJmuqkxixCwiBfXGCYb_RtFZQAdybemDN9UizaoloEtnhQhAs8qGsXHCQ-V2ojq9lpMsKhNQaUVV3TkSlxFtQiEVIxEnb7E4eKdObQg3oKsbRBXIHG54ac-4g8x7zEBB7ccqSAvw0LAqe9UNRrUyldp_RXuNYPwUdsMP3rmbwOrjEyXsojWaRLENvq_coaakhhP3bfna2PK7irU1QI74Wau_HT0FbAkonDS8S0nRdWk1a26md-fPNZDkiu2wILShfMGfqpvsWL2VQouQAB4y4XF2Ee3MPgC3kNKSniKgbxo-k10_DMF4BMvn8e9cYkYack1E1onFmNLalNDMcE1fX6PRK4H_eaG94LvxGetYdZvI4KLEhYVyRbEH79WE1XKQ3-ftv6nvJseTXG_QU7Yb9gzT7L8OeQTL0Epwbf8s07-ADAjgGcawGc_WApA1BCE8fF7btOwH2_S4hV1luokadjnO9FngVA3SGL7ReAt6sjQt4y2lnXglXojarSg0-u_Wgc-WhO9n5gSxLM-x5hgvUYgS7QdD55FjZ5SgtyPvUm1Hr2EExoa5_vhhIPkRnRniGCI8vsDxCAMUoyICX80RImCTRlUfurBmpAYTeULewESPxm7jVwDyh2_1Nuu4r451s65TVCbW8R6OoK6RN7ScMJUXgHc7XBSZYsgC9T4rMctTq4Nrs3EPXbsOoDKPLNgy08vwnKUCM3LM8LHCpAugUHTVj0BFeu_Fu9nj-d-7re9cShpFbd8clJnABsVIKn9Nf9ldT3ry-WnJoDuK4HSByeWVUqoS-sUP_94-I6EPkcrUSNp4SCM5M76kuYCoeBQYbztWOhqACGhznVkgTfluWy9t1e9CvZ9fPl47]--></g></svg>